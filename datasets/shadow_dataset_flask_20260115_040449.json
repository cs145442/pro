[
  {
    "id": "pr-5818",
    "description": "pass context through dispatch methods\n\nThe current `AppContext` object is passed through the various request dispatch methods, rather than each method accessing the proxies. closes #5815 \r\n\r\n@pgjones first proposed this in #5229 as a way to speed up dispatch especially for Quart and async views. This PR applies to more methods, and also implements compatibility during a deprecation period.\r\n\r\nDispatch methods now take `ctx: AppContext` as the first parameter. The following `Flask` methods were changed:\r\n\r\n- `update_template_context`\r\n- `handle_http_exception`\r\n- `handle_user_exception`\r\n- `handle_exception`\r\n- `log_exception`\r\n- `dispatch_request`\r\n- `full_dispatch_request`\r\n- `finalize_request`\r\n- `make_default_options_response`\r\n- `preprocess_request`\r\n- `process_response`\r\n- `do_teardown_request`\r\n- `do_teardown_appcontext`\r\n\r\n`url_for` and `make_response` were not changed, as it's much more likely that these are called from user code that only has access to the proxy.\r\n\r\nAn `__init_subclass__` class method is added to detect old signatures on subclasses of `Flask`. The second parameter is inspected (first is self). If it is not annotated, it must be named `ctx`. If it is annotated, it must either be the string or class `AppContext`. If an old signature is detected, the method is wrapped to remove the argument when other `Flask` methods call it during dispatch. The base method is also wrapped to inject the argument so that `super().base_method` from the overridden method will continue to work.\r\n\r\nI did not apply the compat wrapper to every base `Flask` method, only the ones that a subclass overrides. Therefore, if user code is directly calling these internal dispatch methods, they will get a `TypeError`. This is only likely (and unlikely at that) to happen during testing. I did this over concern that the wrapper would be unnecessary and a performance hit for most applications. If we get bug reports we can consider adding the wrapper.",
    "has_bug": false,
    "base_commit": "adf363679da2d9a5ddc564bb2da563c7ca083916",
    "pr_url": "https://github.com/pallets/flask/pull/5818",
    "merged_at": "2025-11-17T16:49:53Z",
    "expected_files": [
      "CHANGES.rst",
      "src/flask/app.py",
      "src/flask/ctx.py",
      "src/flask/templating.py",
      "tests/test_reqctx.py",
      "tests/test_subclassing.py"
    ]
  },
  {
    "id": "pr-5829",
    "description": "Docs typo/markup fixes\n\nJust two typos I've run into.",
    "has_bug": true,
    "base_commit": "adf363679da2d9a5ddc564bb2da563c7ca083916",
    "pr_url": "https://github.com/pallets/flask/pull/5829",
    "merged_at": "2025-10-14T20:26:26Z",
    "expected_files": [
      "docs/appcontext.rst",
      "docs/design.rst"
    ]
  },
  {
    "id": "pr-5812",
    "description": "merge app and request context\n\nMerges the `RequestContext` class into the `AppContext` class. closes #5639\r\n\r\nA lot of the size of this PR is rewriting or cleaning up docs related to the contexts. See `ctx.py` for the bulk of the work, and even there it's pretty much no new code, mostly deduplication. The \"request context\" still exists, but what data is available on the context object is what distinguishes it from an \"app context\" now.\r\n\r\nHow the user works with the context is pretty much unchanged. For example, `teardown_request` and `teardown_appcontext` still both exist, `app.app_context` and `app.test_request_context`, etc. All the same global proxies, `current_app`, `g`, `request`, and `session` still exist and are still available. in the same situations they were before.\r\n\r\nThe difference is that we no longer have to track whether an app context is already pushed when pushing a request context. This was already sort of an artificial behavior, it was not something that would ever happen under intended/documented request or testing scenarios. Now, every request always sets the app, and the request if request data is given. This greatly simplifies the internal data, as we simply need to record the previous value of the context var to restore on pop.\r\n\r\nSome code in app internals was changed to use the contextvar directly, which code was already doing. This probably gains some tiny bit of performance rather than going through the proxies. When we go ahead with #5229 and beyond, we'll be passing around the context objects directly and won't even need to use the contextvar.\r\n\r\n---\r\n\r\nThere are a few implications for testing that may have used `with app.app_context()` around a test client request. I've already highly discouraged this practice in issues over the years because it was already causing other issues. None of these patterns were in our docs.\r\n\r\nWith the old behavior, an app context was not pushed if one was already pushed when pushing a request context. Therefore,  `teardown_app` functions would only run once the `with` block exited rather than when the request exited. Along with using `with client` around everything, this was already the source of occasional bug reports and questions. The docs also say that no assumptions should be made about how many times a teardown function will be called or what data will be set for them.\r\n\r\nAlso, `g` was part of the app context, not the request context. Data could be set on `g` ahead of the request, because a new app context wouldn't be pushed. This was never documented, I don't know where I saw it.\r\n\r\n```python\r\n# do not do this, for example only\r\nwith app.app_context():\r\n    g.user = test_user\r\n    r = client.get(\"/secret\")\r\n```\r\n\r\nIt's not in Flask's docs or tests. The docs show making a request to login before making the request being tested, relying on the session to persist across requests. If you _really_ wanted to set up `g` beforehand, the signal docs show using the `appcontext_pushed` signal to modify the current context's `g` once it's created.\r\n\r\nA project may run into some failed tests when upgrading, if they were relying on this. However, the failure would indicate patterns that were already unsound and should be fixed, so I don't see this as a blocker.\r\n\r\nInterestingly, `copy_current_request_context` was already not copying `g`. I thought about changing this, but concluded that it was a good thing, because `g` is often used to store connections/caches that are not concurrent safe, such as Flask-SQLAlchemy's `db.session`.",
    "has_bug": false,
    "base_commit": "330123258e8c3dc391cbe55ab1ed94891ca83af3",
    "pr_url": "https://github.com/pallets/flask/pull/5812",
    "merged_at": "2025-09-19T23:45:27Z",
    "expected_files": [
      "CHANGES.rst",
      "docs/api.rst",
      "docs/appcontext.rst",
      "docs/design.rst",
      "docs/extensiondev.rst",
      "docs/index.rst",
      "docs/lifecycle.rst",
      "docs/patterns/sqlalchemy.rst",
      "docs/patterns/sqlite3.rst",
      "docs/patterns/streaming.rst",
      "docs/quickstart.rst",
      "docs/reqcontext.rst",
      "docs/shell.rst",
      "docs/signals.rst",
      "docs/testing.rst",
      "docs/tutorial/blog.rst",
      "docs/tutorial/database.rst",
      "docs/tutorial/templates.rst",
      "docs/tutorial/tests.rst",
      "docs/tutorial/views.rst",
      "src/flask/app.py",
      "src/flask/cli.py",
      "src/flask/ctx.py",
      "src/flask/debughelpers.py",
      "src/flask/globals.py",
      "src/flask/helpers.py",
      "src/flask/json/__init__.py",
      "src/flask/sansio/app.py",
      "src/flask/sansio/scaffold.py",
      "src/flask/templating.py"
    ]
  },
  {
    "id": "pr-5799",
    "description": "refactor stream_with_context for async views\n\nStore the app context as well as the request context when creating the generator. This prevents the request context from automatically creating and pushing a different app context. Then push the app context first, and push them only when iteration starts, not during setup. This prevents the request context from automatically popping the app context, and avoids associating the internal ContextVar with the temporary event loop in async views.\r\n\r\nfixes #5774",
    "has_bug": false,
    "base_commit": "49b7e7bc8fb69d605719991d1c0a99fcee689053",
    "pr_url": "https://github.com/pallets/flask/pull/5799",
    "merged_at": "2025-08-19T15:23:51Z",
    "expected_files": [
      "CHANGES.rst",
      "src/flask/helpers.py",
      "tests/test_helpers.py"
    ]
  },
  {
    "id": "pr-5736",
    "description": "support call template_filter without parens\n\nThis PR enhances the App.template_filter decorator to support:\r\n\r\n- `@app.template_filter` (without parentheses)\r\n\r\nIt also ensures that the original usage remains fully supported, with no breaking changes:\r\n\r\n- `@app.template_filter()`\r\n- `@app.template_filter(name=\"...\")`\r\n- `@app.template_filter(\"...\")`\r\n\r\nI\u2019m not fully confident in the solution, so I\u2019d like to confirm it first. If it\u2019s good, I\u2019ll apply the same change to template_global and template_test.\r\n\r\n---\r\n\r\nI considered the following implementation options:\r\n\r\n1. Rename the input parameter to func_or_name to better reflect the logic of how the input is interpreted:\r\n```\r\ndef template_filter(self, func_or_name: t.Callable[..., t.Any] | str | None = None):\r\n```\r\nHowever, this would be a breaking change for calls like @app.template_filter(name=\"...\"), so I decided to keep the original parameter name for backward compatibility.\r\n\r\n2. Make func_or_name a positional-only parameter and keep name as keyword-only:\r\n```\r\ndef template_filter(self, func_or_name: t.Callable[..., t.Any] | str | None = None, /, *, name: str | None = None):\r\n```\r\n\r\nThis approach is type-safe, but it introduces the awkward case where both func_or_name and name are provided at the same time. It could also be confusing for users reading the function signature.\r\n\r\nSo eventually, I decided to keep the original function parameter and distinguish the usage using `if callable(name):`. I\u2019d like to discuss whether there\u2019s a better approach, and I\u2019m open to making improvements based on feedback and suggestions.\r\n\r\n---\r\n\r\n\r\nfixes https://github.com/pallets/flask/issues/5729\r\n\r\n---\r\n\r\n- [x] Add tests that demonstrate the correct behavior of the change. Tests should fail without the change.\r\n- [x] Add or update relevant docs, in the docs folder and in code.\r\n- [x] Add an entry in CHANGES.rst summarizing the change and linking to the issue.\r\n- [ ] Add `.. versionchanged::` entries in any relevant code docs.\r\n",
    "has_bug": false,
    "base_commit": "85c5d93cbd049c4bd0679c36fd1ddcae8c37b642",
    "pr_url": "https://github.com/pallets/flask/pull/5736",
    "merged_at": "2025-08-19T19:36:01Z",
    "expected_files": [
      "CHANGES.rst",
      "docs/templating.rst",
      "src/flask/sansio/app.py",
      "src/flask/sansio/blueprints.py",
      "tests/test_blueprints.py",
      "tests/test_templating.py"
    ]
  },
  {
    "id": "pr-5795",
    "description": "Update GitHub Actions workflow for artifact handling\n\n## Use `artifact-id` instead of (default assumed) `name` with Actions Artifacts \ud83d\udd12 \r\n\r\nThis pull updates the **publish** workflow to use `artifact-id` instead of the default assumed `name` (in this case the literal word `artifact`) when downloading artifacts that have been previously published in prior workflow steps. This is important because artifacts produced by GitHub Actions can be completely overwritten by other workflow runs if they use the same `name` under very unique circumstances (like passing the `run-id` value to the download-artifact action to point to an entirely different workflow run - don't do that). To avoid potential TOCTOU issues/vulnerabilities where an artifact might be replaced between upload and download, the new `artifact-ids` input allows you to download artifacts by their specific ID rather than by name. This is safer but also helps lead to more deterministic workflow builds by referencing the artifact you wish to download by its _exact id_.\r\n\r\nThis PR also hardens the workflow a bit by adding `persist-credentials: false` to the checkout step.\r\n\r\n---\r\n\r\nI recently did some work to land these exact changes in the [urllib3/urllib3](https://github.com/urllib3/urllib3/pulls?q=is%3Apr+is%3Aclosed+author%3AGrantBirki) and wanted to contribute those same changes here as well! Also recently made updates to Python's [requests](https://github.com/psf/requests/pull/7005) library to do the same.",
    "has_bug": false,
    "base_commit": "55c62556571ee46a94da174643b50ece06edead4",
    "pr_url": "https://github.com/pallets/flask/pull/5795",
    "merged_at": "2025-08-19T20:56:49Z",
    "expected_files": [
      ".github/workflows/publish.yaml"
    ]
  },
  {
    "id": "pr-5800",
    "description": "release version 3.1.2\n\n",
    "has_bug": false,
    "base_commit": "1292419ddfc6a14fc7f85b5ed7efcc2d215f1ad3",
    "pr_url": "https://github.com/pallets/flask/pull/5800",
    "merged_at": "2025-08-19T21:03:43Z",
    "expected_files": [
      "CHANGES.rst",
      "pyproject.toml",
      "uv.lock"
    ]
  },
  {
    "id": "pr-5797",
    "description": "push preserved contexts in correct order\n\nThe test client asks the app to append contexts to a stack, in order to re-push them when using `with client`. However, they were being pushed in reverse order, resulting in the oldest context being seen as current. This PR pushes them in the correct order, meaning `session` will be in the correct state of the last response.\r\n\r\nfixes #5786 ",
    "has_bug": false,
    "base_commit": "5addaf833b2e8c7a616f89dd8ad5a44b07d7c000",
    "pr_url": "https://github.com/pallets/flask/pull/5797",
    "merged_at": "2025-08-18T16:56:39Z",
    "expected_files": [
      "CHANGES.rst",
      "src/flask/testing.py",
      "tests/test_testing.py"
    ]
  },
  {
    "id": "pr-5723",
    "description": "Update macOS UI reference to \u201cSystem Settings\u201d\n\nmade changes to rename system preferences to system settings according to new mac os name change\r\n\r\nDocs: Update macOS UI reference to \u201cSystem Settings\u201d\r\n\r\nThis PR updates the documentation in docs/server.rst to reflect the latest macOS UI terminology.\r\nSpecifically, it replaces the outdated term \u201cSystem Preferences\u201d with \u201cSystem Settings\u201d, aligning with macOS Ventura and later versions.\r\n\r\nWhat Changed\r\n\u2022 Line updated in instructions to disable AirPlay Receiver from:\r\n\u2022 \"System Preferences\" \u2192 \"System Settings\"\r\n\r\nNotes\r\n\u2022 No issue was created for this change, as it is a minor documentation correction.\r\n\u2022 This update does not affect any code or behavior.\r\n\u2022 No test or changelog entry required per contribution guidelines for doc typo-level fixes.",
    "has_bug": false,
    "base_commit": "a42c4d54a3e5cd56c0700479ede75157a748acd6",
    "pr_url": "https://github.com/pallets/flask/pull/5723",
    "merged_at": "2025-08-18T17:08:08Z",
    "expected_files": [
      "docs/server.rst"
    ]
  },
  {
    "id": "pr-5742",
    "description": "Docs: Fix escaping in HTML escaping example\n\nThe code in the [Quickstart's HTML Escaping section](https://flask.palletsprojects.com/en/stable/quickstart/#html-escaping) does not render `name=<script>alert(\"bad\")</script>` to text because the slash in </script> gets interpreted as a trailing slash, leading to a 404.\r\n\r\nGetting the name as a query parameter instead allows:\r\n1. the script tag to be rendered as text if HTML escaping is done\r\n2. the alert in the script tag to be executed if HTML escaping is not done.",
    "has_bug": true,
    "base_commit": "7fea7cf15688b2a2712b01c45c9e3385ea382e67",
    "pr_url": "https://github.com/pallets/flask/pull/5742",
    "merged_at": "2025-08-18T17:20:07Z",
    "expected_files": [
      "docs/quickstart.rst"
    ]
  },
  {
    "id": "pr-5777",
    "description": "use IO[bytes] instead of BinaryIO for wider compatibility\n\n`flask.helpers.send_file` was the only place where `t.BinaryIO` was used. I changed it to be more loose type `t.IO[bytes]`.\r\n\r\nfixes #5776 \r\n",
    "has_bug": false,
    "base_commit": "c56c5ec7c41e6ffd02516bf7cb80dd2ba9ba7aa3",
    "pr_url": "https://github.com/pallets/flask/pull/5777",
    "merged_at": "2025-08-18T17:26:12Z",
    "expected_files": [
      "CHANGES.rst",
      "src/flask/helpers.py"
    ]
  },
  {
    "id": "pr-5798",
    "description": "security docs for TRUSTED_HOSTS\n\ncloses #5718",
    "has_bug": false,
    "base_commit": "ff64079a516c269f171ababf3d92b86886a62ffd",
    "pr_url": "https://github.com/pallets/flask/pull/5798",
    "merged_at": "2025-08-18T18:44:57Z",
    "expected_files": [
      "docs/web-security.rst"
    ]
  },
  {
    "id": "pr-5757",
    "description": "svg logo\n\nUse SVG instead of PNG for the logo.",
    "has_bug": false,
    "base_commit": "f04c5e696400badaa52b3450ded53e9091c2078a",
    "pr_url": "https://github.com/pallets/flask/pull/5757",
    "merged_at": "2025-06-09T21:33:26Z",
    "expected_files": [
      "README.md",
      "docs/_static/flask-horizontal.png",
      "docs/_static/flask-horizontal.svg",
      "docs/_static/flask-icon.svg",
      "docs/_static/flask-vertical.png",
      "docs/_static/flask-vertical.svg",
      "docs/_static/shortcut-icon.png",
      "docs/conf.py",
      "docs/index.rst"
    ]
  },
  {
    "id": "pr-5754",
    "description": "remove slsa provenance\n\nPyPI and trusted publishing has built-in attestation support now.",
    "has_bug": false,
    "base_commit": "a42c4d54a3e5cd56c0700479ede75157a748acd6",
    "pr_url": "https://github.com/pallets/flask/pull/5754",
    "merged_at": "2025-06-08T16:47:45Z",
    "expected_files": [
      ".github/workflows/publish.yaml",
      "pyproject.toml"
    ]
  },
  {
    "id": "pr-5737",
    "description": "Fix global CONTRIBUTING link\n\nFixes the live contributing guidelines link, which just links to https://flask.palletsprojects.com/en/stable/contributing/_contrib (i.e. it puts the RST slug in the URL somehow).\r\n\r\nI wrapped to 80 characters, let me know if that's incorrect.",
    "has_bug": true,
    "base_commit": "bbaf13333fd00644313488243cfe547b13dcae78",
    "pr_url": "https://github.com/pallets/flask/pull/5737",
    "merged_at": "2025-05-20T16:30:06Z",
    "expected_files": [
      "docs/contributing.rst"
    ]
  },
  {
    "id": "pr-5731",
    "description": "drop end of life python versions\n\nhttps://palletsprojects.com/versions\r\n\r\n> When a release is made, it supports all Python versions that are not within six months of end of life (EOL). See [Python's EOL calendar](https://devguide.python.org/versions/) for timing.",
    "has_bug": false,
    "base_commit": "e7e53807766ef1470bce546716a675ded4b08597",
    "pr_url": "https://github.com/pallets/flask/pull/5731",
    "merged_at": "2025-05-13T15:35:41Z",
    "expected_files": [
      ".github/workflows/tests.yaml",
      "CHANGES.rst",
      "docs/extensiondev.rst",
      "docs/installation.rst",
      "pyproject.toml",
      "src/flask/cli.py",
      "src/flask/json/provider.py",
      "src/flask/sansio/app.py",
      "src/flask/typing.py",
      "tests/test_cli.py",
      "uv.lock"
    ]
  }
]